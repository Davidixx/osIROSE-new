set(SQLPP11_INSTALL_DIR ${CMAKE_THIRD_PARTY_DIR})

if(WIN32)
  ExternalProject_Add(
    sqlpp11
    GIT_REPOSITORY https://github.com/rbock/sqlpp11
    GIT_TAG c789f919012a9dedd30b7a48b0da7671bb1a1bc4
    CMAKE_ARGS -G ${CMAKE_GENERATOR} -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} -DHinnantDate_INCLUDE_DIR=${DATE_INCLUDE_DIR} -DCMAKE_INSTALL_PREFIX=${SQLPP11_INSTALL_DIR} -DENABLE_TESTS=OFF
    INSTALL_DIR ${SQLPP11_INSTALL_DIR}
    DEPENDS DATE::DATE
  )
else()
  ExternalProject_Add(
    sqlpp11
    GIT_REPOSITORY https://github.com/rbock/sqlpp11
    GIT_TAG c789f919012a9dedd30b7a48b0da7671bb1a1bc4
    CMAKE_ARGS -G ${CMAKE_GENERATOR} -DCMAKE_INSTALL_PREFIX=${SQLPP11_INSTALL_DIR} -DHinnantDate_INCLUDE_DIR=${DATE_INCLUDE_DIR} -DENABLE_TESTS=OFF
    #BUILD_BYPRODUCTS ${_byproducts}
    INSTALL_DIR ${SQLPP11_INSTALL_DIR}
    DEPENDS DATE::DATE
    BUILD_COMMAND cmake --build . --target install
  )
endif()

ExternalProject_Get_Property(
  sqlpp11
  install_dir
)

set(SQLPP11_INCLUDE_DIR "${install_dir}/include")
if(NOT TARGET SQLPP11::SQLPP11)
    add_library(SQLPP11::SQLPP11 INTERFACE IMPORTED)
    add_dependencies(SQLPP11::SQLPP11 sqlpp11)
    set_target_properties(SQLPP11::SQLPP11 PROPERTIES INTERFACE_INCLUDE_DIRECTORIES "${SQLPP11_INCLUDE_DIR}")
endif()